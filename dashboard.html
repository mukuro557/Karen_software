<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.3.2/bootbox.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script>



    <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
    <link href="assets/vendor/fonts/circular-std/style.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/libs/css/style.css">
    <link rel="stylesheet" href="assets/vendor/fonts/fontawesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="assets/vendor/vector-map/jqvmap.css">
    <link href="assets/vendor/jvectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/vendor/charts/morris-bundle/morris.css">
    <link rel="stylesheet" type="text/css" href="assets/vendor/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://www.cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>

    <title>นับครุภัณฑ์</title>

    <script>
        var table
        var user
        $(document).ready(function () {

            $("form").submit(function (e) {
                e.preventDefault();

                if (document.getElementById("fileUpload").files.length == 0) {
                    //or use jQuery
                    // if($('#fileUpload')[0].files.length === 0)
                    $(".alertText").html("กรุณาเลือกไฟล์")
                        $("#alertmodal").modal();
                    return;
                }
                const formData = new FormData(this);
                var today = new Date();
                            var yyyy = today.getFullYear();


                $.ajax({
                    method: "GET",
                    url: "/item/dashboard/showuser"
                }).done(function (data, state, xhr) {

                    if (data.length > 1) {
                        $(".btn-sm").hide();
                        $(".but").append('<input class="btn btn-sm" type="button" value = "ตกลง" onclick = "location.reload()" style="float: right; background-color: #0a72c1; color:white">')
                        $(".alertText").html("ปีนี้ได้ทำการแสกนแล้ว จึงไม่สามารถอัพโหลดเพิ่มเติม")
                        $("#alertmodal").modal();
                        $("#upload").modal("hide");
                    } else {
                        $.ajax({
                            method: "GET",
                            url: "/item/dashboard/showuser"
                        }).done(function (dataSet, state, xhr) {
                            if (dataSet.length != 0) {
                                var r = confirm("ปีนี้ได้อัพโหลดแล้ว ถ้าอัพโหลดซ้ำ จะทำการล้างข้อมูลเก่าทั้งหมด");
                                if (r) {
                                    $.ajax({
                                        method: "POST",
                                        url: "/uploadif/" + user,
                                        data: formData,
                                        contentType: false,
                                        processData: false,
                                        success: function (data, state, xhr) {
                                            $(".btn-sm").hide();
                                            $(".but").append('<input class="btn btn-sm" type="button" value = "ตกลง" onclick = "location.reload()" style="float: right; background-color: #0a72c1; color:white">')
                                            $(".alertText").html("บันทึกสำเร็จ")
                                            $("#alertmodal").modal();
                                            $("#upload").modal("hide");
                                        },
                                        error: function (xhr, state, err) {
                                            $(".btn-sm").hide();
                                            $(".but").append('<input class="btn btn-sm" type="button" value = "ตกลง" onclick = "location.reload()" style="float: right; background-color: #0a72c1; color:white">')
                                            $(".alertText").html(xhr.responseText)
                                            $("#alertmodal").modal();
                                            $("#upload").modal("hide");
                                            
                                        }
                                    })
                                }
                            } else {
                                
                                $.ajax({
                                    method: "POST",
                                    url: "/uploading/" + user,
                                    data: formData,
                                    contentType: false,     //tell jQuery not to add a Content-Type header for us
                                    processData: false,      //tell jQuery not to convert the formData object to a string
                                    success: function (data, state, xhr) {
                                        $(".btn-sm").hide();
                                        $(".but").append('<input class="btn btn-sm" type="button" value = "ตกลง" onclick = "location.reload()" style="float: right; background-color: #0a72c1; color:white">')
                                        $(".alertText").html(data)
                                        $("#alertmodal").modal();
                                        
                                       
                                    },
                                    error: function (xhr, state, err) {
                                        $(".btn-sm").hide();
                                        $(".but").append('<input class="btn btn-sm" type="button" value = "ตกลง" onclick = "location.reload()" style="float: right; background-color: #0a72c1; color:white">')
                                        $(".alertText").html(xhr.responseText)
                                        $("#alertmodal").modal();
                                        
                                    }
                                });
                                 $("#upload").modal("hide");
                                
                            }
                        })
                    }
                }).fail(function (xhr, state, error) {
                   $(".alertText").html(xhr.responseText)
                    $("#alertmodal").modal();

                });


            });


            //====================================== drop down year ======================================
            $.ajax({
                method: "GET",
                url: "/item/Year"
            }).done(function (data, state, xhr) {

                var values = [];
                for (let i = 0; i < data.length; i++) {
                    values[i] = [data[i].Year]
                }
                values[data.length] = 'ปีตรวจ'
                $('.year').append($(document.createElement('select')).prop({

                    class: 'year',
                    name: 'year',
                    style: 'border-color: white',
                    class: 'mt-3 ml-3 year',
                    id: 'Year',
                    name: 'Year'
                })
                )


                //drop down status year
                for (let i = values.length - 1; i >= 0; i--) {
                    $('#Year').append($(document.createElement('option')).prop({
                        value: values[i],
                        text: values[i],
                        class: values[i]
                    }))
                }
                $('.ปีตรวจ').hide()

                $('select.year').change(function () {
                    var selected = $(this).children("option:selected").val();

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/number1/" + selected
                    }).done(function (dataSet, state, xhr) {
                        $("#all").html(dataSet[0].Numbers_of_item);
                    })
                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/number2/0/" + selected
                    }).done(function (dataSet, state, xhr) {
                        $("#dis").html(dataSet[0].Numbers_of_item);
                    })

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/number2/1/" + selected
                    }).done(function (dataSet, state, xhr) {
                        $("#normal").html(dataSet[0].Numbers_of_item);
                    })
                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/number2/2/" + selected
                    }).done(function (dataSet, state, xhr) {
                        $("#fix").html(dataSet[0].Numbers_of_item);
                    })

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/showAllInfo4/" + selected
                    }).done(function (dataSet, state, xhr) {
                        for (let i = 0; i < dataSet.length; i++) {
                            if (dataSet[i].Status == 0) {
                                dataSet[i].Status = "สูญหาย"
                            } else if (dataSet[i].Status == 1) {
                                dataSet[i].Status = "ปกติ"
                            } else if (dataSet[i].Status == 2) {
                                dataSet[i].Status = "ส่งซ่อม"
                            }
                        }
                        for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].takepicture == 0) {
                        dataSet[i].takepicture = "ไม่ต้องการรูปภาพ"
                    } else if (dataSet[i].takepicture == 1) {
                        dataSet[i].takepicture = "ต้องการรูป"
                    }
                    var nf = new Intl.NumberFormat();
                    dataSet[i].Original_value = nf.format(dataSet[i].Original_value);
                    if (dataSet[i].Image === null) {
                        dataSet[i].Image = "/img/noimg.png"
                    } 
                }
                        table.clear();
                        //display modified JSON in DataTable
                        table.rows.add(dataSet).draw();
                    })

                })
            })

            //====================================== drop down location ======================================
            $.ajax({
                method: "GET",
                url: "/item/Location"
            }).done(function (data, state, xhr) {

                var values = [];
                for (let i = 0; i < data.length; i++) {
                    values[i] = [data[i].Location]
                }
                values[data.length] = 'สถานที่'
                $('.btnGroupDrop1').append(
                    $(document.createElement('select')).prop({
                        style: 'border-color: white',
                        class: 'mt-3 ml-3 location',
                        id: 'Location',
                        name: 'Location'
                    })
                )

                //drop down status Location
                for (let i = values.length - 1; i >= 0; i--) {
                    $('#Location').append($(document.createElement('option')).prop({
                        value: values[i],
                        text: values[i],
                        class: values[i]
                    }))
                }
                $('.สถานที่').hide()

                $('select.location').change(function () {
                    var selected = $(this).children("option:selected").val();

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/showAllInfo/" + selected
                    }).done(function (dataSet, state, xhr) {
                        for (let i = 0; i < dataSet.length; i++) {
                            if (dataSet[i].Status == 0) {
                                dataSet[i].Status = "สูญหาย"
                            } else if (dataSet[i].Status == 1) {
                                dataSet[i].Status = "ปกติ"
                            } else if (dataSet[i].Status == 2) {
                                dataSet[i].Status = "ส่งซ่อม"
                            }
                        }
                        for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].takepicture == 0) {
                        dataSet[i].takepicture = "ไม่ต้องการรูปภาพ"
                    } else if (dataSet[i].takepicture == 1) {
                        dataSet[i].takepicture = "ต้องการรูป"
                    }
                    var nf = new Intl.NumberFormat();
                    dataSet[i].Original_value = nf.format(dataSet[i].Original_value);
                    if (dataSet[i].Image === null) {
                        dataSet[i].Image = "/img/noimg.png"
                    } 
                }
                        table.clear();
                        //display modified JSON in DataTable
                        table.rows.add(dataSet).draw();
                    })
                })
            })
            //====================================== drop down status ======================================
            $.ajax({
                method: "GET",
                url: "/item/Status"
            }).done(function (data, state, xhr) {

                var values = [];
                for (let i = 0; i < data.length; i++) {
                    if (data[i].Status == 0) {
                        values[i] = "สูญหาย"
                    } else if (data[i].Status == 1) {
                        values[i] = "ปกติ"
                    } else if (data[i].Status == 2) {
                        values[i] = "ส่งซ่อม"
                    }

                } values[data.length] = 'สถานะ'
                $('.btnGroupDrop2')

                    .append(
                        $(document.createElement('select')).prop({
                            style: 'border-color: white',
                            class: 'mt-3 ml-3 status',
                            id: 'Status',
                            name: 'Status'
                        })
                    )

                //drop down status Location
                for (let i = values.length - 1; i >= 0; i--) {
                    $('#Status').append($(document.createElement('option')).prop({
                        value: values[i],
                        text: values[i],
                        class: values[i]
                    }))
                }
                $('.สถานะ').hide()

                $('select.status').change(function () {
                    var selected = $(this).children("option:selected").val();
                    let num
                    if (selected == "ส่งซ่อม") {
                        num = 2
                    } else if (selected == "ปกติ") {
                        num = 1
                    } else if (selected == "สูญหาย") {
                        num = 0
                    }

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/showAllInfo1/" + num
                    }).done(function (dataSet, state, xhr) {
                        
                        for (let i = 0; i < dataSet.length; i++) {
                            if (dataSet[i].Status == 0) {
                                dataSet[i].Status = "สูญหาย"
                            } else if (dataSet[i].Status == 1) {
                                dataSet[i].Status = "ปกติ"
                            } else if (dataSet[i].Status == 2) {
                                dataSet[i].Status = "ส่งซ่อม"
                            }
                        }
                        for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].takepicture == 0) {
                        dataSet[i].takepicture = "ไม่ต้องการรูปภาพ"
                    } else if (dataSet[i].takepicture == 1) {
                        dataSet[i].takepicture = "ต้องการรูป"
                    }
                    var nf = new Intl.NumberFormat();
                    dataSet[i].Original_value = nf.format(dataSet[i].Original_value);
                    if (dataSet[i].Image === null) {
                        dataSet[i].Image = "/img/noimg.png"
                    } 
                }
                        table.clear();
                        //display modified JSON in DataTable
                        table.rows.add(dataSet).draw();
                    })
                })
            })

            //====================================== drop down commitee ======================================
            $.ajax({
                method: "GET",
                url: "/item/Email_Committee"
            }).done(function (data, state, xhr) {
                var values = [];
                for (let i = 0; i < data.length; i++) {
                    if (data[i].Email_Committee !== null) {
                        values[i] = [data[i].Email_Committee]
                    } else {
                    }
                } values[data.length] = 'คณะกรรมการผู้ตรวจสอบ'
                $('.commitee')
                    .append(
                        $(document.createElement('select')).prop({
                            style: 'border-color: white; max-width : 4.6cm',
                            class: 'mt-3 ml-3 commitee',
                            id: 'Email_Committee',
                            name: 'Email_Committee'
                        })
                    )

                //drop down status Location
                for (let i = values.length - 1; i >= 0; i--) {
                    $('#Email_Committee').append($(document.createElement('option')).prop({
                        value: values[i],
                        text: values[i],
                        class: values[i]
                    }))
                }
                $('.คณะกรรมการผู้ตรวจสอบ').hide()

                $('select.commitee').change(function () {
                    var selected = $(this).children("option:selected").val();

                    $.ajax({
                        method: "GET",
                        url: "/item/dashboard/showAllInfo3/" + selected
                    }).done(function (dataSet, state, xhr) {
                        for (let i = 0; i < dataSet.length; i++) {
                            if (dataSet[i].Status == 0) {
                                dataSet[i].Status = "สูญหาย"
                            } else if (dataSet[i].Status == 1) {
                                dataSet[i].Status = "ปกติ"
                            } else if (dataSet[i].Status == 2) {
                                dataSet[i].Status = "ส่งซ่อม"
                            }
                        }
                        for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].takepicture == 0) {
                        dataSet[i].takepicture = "ไม่ต้องการรูปภาพ"
                    } else if (dataSet[i].takepicture == 1) {
                        dataSet[i].takepicture = "ต้องการรูป"
                    }
                    var nf = new Intl.NumberFormat();
                    dataSet[i].Original_value = nf.format(dataSet[i].Original_value);
                    if (dataSet[i].Image === null) {
                        dataSet[i].Image = "/img/noimg.png"
                    } 
                }
                        
                        table.clear();
                        //display modified JSON in DataTable
                        table.rows.add(dataSet).draw();
                    })
                })
            })


            $("#all").click(function () {
                window.location.replace("/information");
            });

            table = $('#myTable').DataTable({


                columns: [
                    {
                        "mData": "Asset_Number", title: "<input type='checkbox' id='select-all' name='select-all'>",
                        "render": function (data) {
                            return '<input type="checkbox" name="singleCheckbox" value=' + data + '>';
                        }
                    },
                    {
                        "mData": "Image", title: "รูปภาพ",
                        "render": function (data) {
                            return '<img class="pic" src="' + data + '" style="width: 100px;margin: 25px;-webkit-transition: all .4s ease-in-out;-moz-transition: all .4s ease-in-out;-o-transition: all .4s ease-in-out; -ms-transition: all .4s ease-in-out; "  />';
                        }
                    },
                    { data: "Asset_Number", title: "รหัสครุภัณฑ์" },
                    { data: "Location", title: "สถานที่" },
                    { data: "Received_date", title: "วันที่ได้รับ" },
                    { data: "Original_value", title: "มูลค่า" },
                    { data: "takepicture", title: "ถ่ายรูป" },
                    { data: "Date_scan", title: "วันที่ตรวจสอบ" },
                    { data: "Email_Committee", title: "ผู้ตรวจ" },
                    { data: "Status", title: "สถานะ" },
                ],

            });


            $('#select-all').click(function (event) {
                if (this.checked) {
                    // Iterate each checkbox
                    $(':checkbox').each(function () {
                        this.checked = true;
                    });
                } else {
                    $(':checkbox').each(function () {
                        this.checked = false;
                    });
                }
            });

            $("#take").click(function () {
                var selectedItem = [];
                $.each($("input[name='singleCheckbox']:checked"), function () {
                    selectedItem.push($(this).val());
                });
                $.ajax({
                    method: "PUT",
                    url: "/item/take",
                    data: { take: selectedItem },

                }).done(function (dataSet, state, xhr) {
                    if (selectedItem[0] === undefined) {
                        $(".alertText").html("กรุณาเลือกครุภัณฑ์อย่างน้อย 1 ชิ้น")
                        $("#alertmodal").modal();
                    } else {
                        $(".alertText").html("บันทึกสำเร็จ")
                        $("#alertmodal").modal();
                        
                    }


                }).fail(function (xhr, state, error) {
                    $(".alertText").html(xhr.responseText)
                    $("#alertmodal").modal();
                });

            });

            $("#qrcode").click(function () {

                var selectedItem = [];
                $.each($("input[name='singleCheckbox']:checked"), function () {
                    selectedItem.push($(this).val());
                });
                if (selectedItem[0] === undefined) {
                    $(".alertText").html("กรุณาเลือกครุภัณฑ์อย่างน้อย 1 ชิ้น")
                    $("#alertmodal").modal();
                } else {
                    window.sessionStorage.setItem("items", JSON.stringify(selectedItem));
                    var storedArray = JSON.parse(sessionStorage.getItem("items"));
                    window.location.href = "/printqrcode";
                }


            });


            $.ajax({
                method: "GET",
                url: "/profile/infouser"
            }).done(function (data, state, xhr) {
                user = data.email
                $("#user").html(data.name);
                document.getElementById('pic').src = data.photo;
                if (data.email === undefined) {
                    window.location.replace("/checkpage")
                } else {
                    $.ajax({
                        method: "GET",
                        url: "/manageUser/showAllUsers/" + data.email
                    }).done(function (dataSet, state, xhr) {
                        if (dataSet[0] === undefined) {
                            window.location.replace("/checkpage")
                        }
                        if (dataSet[0].role == 2) {
                            $("#manageu").hide();
                            $("#take").hide();
                            $("#import").hide();
                        }
                        for (let i = 0; i < dataSet.length; i++) {
                            if (dataSet[i].role == 2) {
                                dataSet[i].role = "กรรมการ"
                            } else if (dataSet[i].role == 1) {
                                dataSet[i].role = "แอดมิน"
                            }
                        }
                        $("#rol2").html(dataSet[0].role)


                    }).fail(function (xhr, state, error) {
                        //get data failed
                        $(".alertText").html(xhr.responseText)
                        $("#alertmodal").modal();
                    });
                }
            }).fail(function (xhr, state, error) {
                //get data failed
                $(".alertText").html(xhr.responseText)
                $("#alertmodal").modal();
            });
            // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<  number  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
            $.ajax({
                method: "GET",
                url: "/item/dashboard/number"
            }).done(function (dataSet, state, xhr) {
                $("#all").html(dataSet[0].Numbers_of_item);
            })
            $.ajax({
                method: "GET",
                url: "/item/dashboard/number/0"
            }).done(function (dataSet, state, xhr) {
                $("#dis").html(dataSet[0].Numbers_of_item);
            })

            $.ajax({
                method: "GET",
                url: "/item/dashboard/number/1"
            }).done(function (dataSet, state, xhr) {
                $("#normal").html(dataSet[0].Numbers_of_item);
            })
            $.ajax({
                method: "GET",
                url: "/item/dashboard/number/2"
            }).done(function (dataSet, state, xhr) {
                $("#fix").html(dataSet[0].Numbers_of_item);
            })

            getItem();

        });

        function getItem() {
            //get users from DB
            $.ajax({
                method: "GET",
                url: "/item/dashboard/showAllInfo"
            }).done(function (dataSet, state, xhr) {
               
                // takepicture
                for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].Status == 0) {
                        dataSet[i].Status = "สูญหาย"
                    } else if (dataSet[i].Status == 1) {
                        dataSet[i].Status = "ปกติ"
                    } else if (dataSet[i].Status == 2) {
                        dataSet[i].Status = "ส่งซ่อม"
                    }
                }
                for (let i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].takepicture == 0) {
                        dataSet[i].takepicture = "ไม่ต้องการรูปภาพ"
                    } else if (dataSet[i].takepicture == 1) {
                        dataSet[i].takepicture = "ต้องการรูป"
                    }
                    var nf = new Intl.NumberFormat();
                    dataSet[i].Original_value = nf.format(dataSet[i].Original_value);
                    if (dataSet[i].Image === null) {
                        dataSet[i].Image = "/img/noimg.png"
                    } 
                }
                table.clear();
                //display modified JSON in DataTable
                table.rows.add(dataSet).draw();


                $.ajax({
                    method: "GET",
                    url: "/year/iteem"
                }).done(function (data, state, xhr) {

                    let year = [];
                    let normal = []
                    let dis = []
                    let fix = []

                    for (let i = 0; i < data.length; i++) {
                        let normalna = 0;
                        let fixna = 0;
                        let disna = 0;
                        year[i] = data[i].Year
                        for (let j = 0; j < dataSet.length; j++) {

                            if (dataSet[j].Year == year[i]) {
                                if (dataSet[j].Status == 'ปกติ') {

                                    normalna++;
                                } else if (dataSet[j].Status == 'สูญหาย') {
                                    fixna++;
                                } else if (dataSet[j].Status == 'ส่งซ่อม') {
                                    disna++;
                                }
                            }
                        }
                        normal[i] = normalna;
                        dis[i] = disna;
                        fix[i] = fixna;


                    }
                   

                    var datas = [];
                    let count = year.length
                    for (let i = 0; i < 5; i++) {

                        if (count == year.length) {
                            datas = [{ y: year[i], a: normal[i], b: dis[i], c: fix[i] }]
                            count--;

                        } else {
                            datas.push({ y: year[i], a: normal[i], b: dis[i], c: fix[i] })

                        }

                    }


                    window.barChart = Morris.Bar({
                        element: 'bar-chart',
                        data: datas,
                        xkey: 'y',
                        ykeys: ['a', 'b', 'c'],
                        labels: ['ปกติ', 'ซ่อม', 'สูญหาย'],
                        color: ['#ffffff', '#ffffff', '#ffffff'],
                        lineWidth: '3px',
                        barColors: ['#73e2a9', '#fdc538', '#fa986d'],
                        width: 60,
                        height: 40,
                        resize: true,
                        redraw: true
                    });
                })

            }).fail(function (xhr, state, error) {
                //get data failed
                $(".alertText").html(xhr.responseText)
                $("#alertmodal").modal();
            });
        }
    </script>
<style>
    

    .morris-hover.morris-default-style {
      border-radius: 10px;
      padding: 6px;
      color: #000000;
      background: rgb(255, 255, 255);
      border: solid 2px rgb(230, 230, 230);
      font-family: sans-serif;
      font-size: 12px;
      text-align: center;
    }

    

   
  </style>


</head>

<body  style="background-color:rgba(255, 255, 255, 0.768)">
    <div class="dashboard-main-wrapper">
    <!-- navbar -->
    <!-- ============================================================== -->
    <div class="dashboard-header">
        <nav class="navbar navbar-expand-lg bg-white fixed-top">
            <div class="row">
                <div class="col-sm-2 ml-4">
                    <img src="img/logoit.JPG" style="width: 280px;">
                </div>
            </div>

            <ul class="navbar-nav ml-auto navbar-right-top">

                <li class="nav-item dropdown notification">
                   
                    <ul class="dropdown-menu dropdown-menu-right notification-dropdown">

                        <li>
                            <div class="list-footer"> <a href="#">การแจ้งเตือนทั้งหมด</a></div>
                        </li>
                    </ul>
                </li>

                <li class="nav-item dropdown nav-user">
                    <a class="nav-link nav-user-img" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false"><img id="pic" src="assets/images/avatar-1.jpg" alt=""
                            class="user-avatar-md rounded-circle"></a>
                    <div class="dropdown-menu dropdown-menu-right nav-user-dropdown"
                        aria-labelledby="navbarDropdownMenuLink2">
                        <div class="nav-user-info">
                            <h5 class="mb-0 text-white nav-user-name user" id="user">Ruttathorn </h5>
                            <span class="status"></span><span class="ml-2" id="rol2">กรรมการ</span>
                        </div>
                        <a class="dropdown-item" href="/auth/logout"><i class="fas fa-power-off mr-2"></i>ออกจากระบบ</a>
                    </div>
                </li>
            </ul>

        </nav>
    </div>
    <!-- ============================================================== -->
    <!-- จบ navbar -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- navbar ด้านข้าง -->
    <!-- ============================================================== -->
    <div class="nav-left-sidebar sidebar-light">
        <div class="menu-list">
            <nav class="navbar navbar-expand-lg navbar-light">
                <a class="d-xl-none d-lg-none" href="#">Dashboard</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav flex-column">

                        <li class="nav-item ">
                            <a class="nav-link" href="/mainpage" aria-expanded="false"><i
                                    class="fa fa-home"></i>หน้าหลัก
                            </a>
                            <div id="submenu-1" class="collapse submenu">
                                <ul class="nav flex-column">

                                </ul>
                            </div>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link " href="/User_history" aria-expanded="false"><i
                                    class="fa fa-user"></i>โปรไฟล์ </a>
                            <div id="submenu-1" class="collapse submenu">
                                <ul class="nav flex-column">

                                </ul>
                            </div>
                        </li>

                        <li class="nav-item ">
                            <a class="nav-link active" href="/dashboard" aria-expanded="false"><i
                                    class="fa fa-dashboard"></i>แดชบอร์ด </a>
                            <div id="submenu-1" class="collapse submenu">
                                <ul class="nav flex-column">

                                </ul>
                            </div>
                        </li>

                        <li class="nav-item " id="manageu">
                            <a class="nav-link " href="/manageUser" aria-expanded="false"><i
                                    class="fa fa-edit"></i>จัดการผู้ใช้
                            </a>
                            <div id="submenu-1" class="collapse submenu">
                                <ul class="nav flex-column">

                                </ul>
                            </div>
                        </li>

                        <li class="nav-item ">
                            <a class="nav-link " href="/Date_manage" aria-expanded="false"><i
                                    class="fa fa-clock"></i>จัดการเวลา
                            </a>
                            <div id="submenu-1" class="collapse submenu">
                                <ul class="nav flex-column">
                                </ul>

                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>

    </div>
    <!-- ============================================================== -->
    <!-- เสร็จ navbar -->
    <!-- ============================================================== -->

    <div class="dashboard-wrapper mt-5" style="background-color:rgba(255, 255, 255, 0.768)">
        <div class="dashboard-finance" >
            <div class="container-fluid dashboard-content" >
                <!-- ============================================================== -->
                <!-- หัวกระดาษ  -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2">
                        <div class="page-header ml-5 mt-2">
                            <h3 class="mb-2 ">แดชบอร์ด </h3>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                        <!-- ======================================================== -->
                        <!-- ดรอปดาว -->
                        <!-- ======================================================== -->
                        <div class="input-group mb-3">
                            <div class="input-group-append be-addon">
                                <div class="btn-group" role="group">
                                    <div class="year">

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row mt-3 ml-3">
                <div class=" col-xl-1 col-lg-1 col-md-1 col-sm-1 col-1" >

                </div>
                <div class="card col-xl-2 col-lg-2 col-md-2 col-sm-2 col-1 mr-5" style="background-color:#eeefff">
                    <div class="card-body " style="height: 3cm; width: 5cm;">
                        <div class="row">
                            <div class="col-xl-8.9 col-lg-8.9  col-md-8.9  col-sm-8.9  col-8.9  ">
                               <b style="color: #000000;">ครุภัณฑ์ทั้งหมด</b> 
                                <h1 id="all">5000</h1>
                            </div>
                            <div class="col-xl-1 col-lg-1 col-md-1 col-sm-1 col-1 ml-4">
                                <img class="" src="img/all.PNG " alt="" style="width:0.99cm;">
                            </div>
                        </div>


                    </div>
                </div>
                <div class="card col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 mr-5 " style="background-color: #e7f5ee;">
                    <div class="card-body pr-4" style="height: 3cm; width: 5cm;">
                        <div class="row">
                            <div class="col-xl-8.9 col-lg-8.9  col-md-8.9  col-sm-8.9  col-8.9 ml-4  ">
                               <a style="color: black;">ครุภัณฑ์ปกติ</a> 
                                <h1 id="normal">5000</h1>
                            </div>
                            <div class="col-xl-1 col-lg-1 col-md-1 col-sm-1 col-1 ml-4">
                                <img class="" src="img/normal.png" alt="" style="width:0.99cm;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 mr-5 " style="background-color: #f9f2d5;">
                    <div class="card-body pr-4" style="height: 3cm; width: 5cm;">
                        <div class="row">
                            <div class="col-xl-8.9 col-lg-8.9  col-md-8.9  col-sm-8.9  col-8.9  ">
                               <a style="color: black;">ครุภัณฑ์ส่งซ่อม</a> 
                                <h1 id="fix">5000</h1>
                            </div>
                            <div class="col-xl-1 col-lg-1 col-md-1 col-sm-1 col-1 ml-4">
                                <img class="" src="img/fix.PNG" alt="" style="width:0.99cm;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 mr-5" style="background-color: #fbe1d3;">
                    <div class="card-body pr-4" style="height: 3cm; width: 5cm;">
                        <div class="row">
                            <div class="col-xl-8.9 col-lg-8.9  col-md-8.9  col-sm-8.9  col-8.9  ">
                               <a style="color: #000000;">ครุภัณฑ์สูญหาย</a> 
                                <h1 id="dis">5000</h1>
                            </div>
                            <div class="col-xl-1 col-lg-1 col-md-1 col-sm-1 col-1 ml-4">
                                <img class="" src="img/dis.PNG" alt="" style="width:0.99cm;">
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- ============================================================== -->
            <!-- เสร็จหัวกระดาษ  -->
            <!-- ============================================================== -->
            <!-- แถบ -->
            <!-- ============================================================== -->
            <!--กราฟ-->
            <!-- ============================================================== -->
            <div class="col">
                <div class="row ">
                    <div class=" col-xl-11 col-lg-11 col-md-11 col-sm-11 col-11 ml-5 " style="background-color: white">
                        <div id="bar-chart"></div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- ตารางข้อมูล -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <div class="container my-2 " style="background-color: white;">
                    <br>
                    <div class="btn-group" role="group" aria-label="Button group with nested dropdown">


                        <div class="btn-group" role="group">
                            <div class="btnGroupDrop1"></div>

                        </div>


                        <div class="btn-group" role="group">
                            <div class="btnGroupDrop2"></div>
                        </div>

                        <div class="btn-group" role="group">
                            <div class="commitee"></div>
                        </div>
                        <a href="/dashboard">
                            <button type="button" href="#" class="btn "
                                style="color: red;">รีเซตการกรอง</button></a><br><br>

                    </div>
                    <button class="btn" class="btn btn-primary" data-toggle="modal" data-target="#upload"
                        id="import">นำเข้าไฟล์</button>
                    <button class="btn" class="btn btn-primary" data-toggle="modal" data-target="#modalPushExcel"
                        id="#">นำออกไฟล์</button>
                    <button class="btn" id="qrcode">Qrcode</button>
                    <button class="btn" id="take">ถ่ายรูป</button>
                    
                    <br> <br><br><br>
                    <table id="myTable" class="table table-striped table-bordered mt-3" style="width:100%">
                    </table>
                </div>

                <!-- ============================================================== -->
                <!-- จบตาราง -->
                <!--Modal: Export to excel-->
                <div class="modal fade" id="modalPushExcel" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-notify modal-info" role="document">
                        <!--Content-->
                        <div class="modal-content text-center">
                            <!--Header-->
                            <div class="modal-header d-flex justify-content-center">
                                <p class="heading">นำออกไฟล์</p>
                            </div>

                            <!--Body-->
                            <div class="modal-body">

                                <i class="fas fa-bell fa-4x animated rotateIn mb-4"></i>

                                <p>ต้องการจะนำออกไฟล์ใช่หรือไม่</p>

                            </div>

                            <!--Footer-->
                            <div class="modal-footer flex-center">

                                <button class="btn btn-info" id="excelExport">นำออกไฟล์ Excel</button>
                                <button class="btn btn-success" id="btn_export_PDF">นำออกไฟล์ PDF</button>

                                <a type="button" class="btn btn-outline-info waves-effect"
                                    data-dismiss="modal">ยกเลิก</a>
                            </div>
                        </div>
                        <!--/.Content-->
                    </div>
                </div>
                <!--Modal: Export to excel-->


                <!-- ============================================================== -->
                <!-- modal  -->
                <!-- ============================================================== -->

                <div class="modal fade bd-example-modal-md" id="upload" tabindex="-1" role="dialog"
                    aria-labelledby="mySmallModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Upload exel ไปยังระบบ</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form method="post" enctype="multipart/form-data">
                                    <input type="file" name="filetoupload" id="fileUpload" accept=".xlsx, .xls"><br>
                                    <input type="submit" class="btn btn-primary mt-3" value="Upload">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- เสร็จ modal  -->
                <!-- ============================================================== -->
                <div class="modal bd-example-modal-sm fade" id="alertmodal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" data-backdrop="static" data-keyboard="false" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content"  style="background-color : #3f3f3f">
                        <div class="modal-body">
                            <h5 style="color: #ffffff; font-weight:bold;">ประกาศ</h5>
                          <p class="alertText" style="color: white">กรุณาติดต่อเพื่อขอใช้บริการ</p>
                          <input class="btn btn-sm" type="button" value = "ตกลง" onclick = " window.location.replace('/auth/logout')" style="float: right; background-color: #0a72c1; color:white">
                          <!-- <button  type="button" class="btn btn-primary" style="width: 2cm; float: right;" onclick = " window.location.replace('/auth/logout')">ตกลง</button> -->
                        </div>
                          
                        
                      </div>
                    </div>
                  </div>
                 <!-- ============================================================== -->
                <!-- เสร็จ modal  -->
                <!-- ============================================================== -->
            </div>

            <!-- footer  -->
            <!-- ============================================================== -->

            <div class="" style="background-color:  rgb(50, 50, 51);  ">
                <div class="row ml-5 mr-5" style="background-color: rgb(50, 50, 51);">
                    <div class="col-xs-12 col-sm-12 col-md-4 mt-5">
                        <h3>
                            <blockquote>
                                <img src="/img/itlogo.png">
                                <h4 style="color:azure;font-size:30px;">สำนักวิชาเทคโนโลยีสารสนเทศ</h4>
                                <div style="border: 0.5px solid red; width: 7cm;"></div>
                                <code style="color: azure;font-size: 20px;">มหาวิทยาลัยแม่ฟ้าหลวง</code>
                            </blockquote>
                        </h3>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-4 mt-5">
                        <div class="copyright">
                            <h4 class="header-footer" style="color: azure;">ติดต่อ <br>
                                <div style="border: 1px solid red; width: 7cm;"></div>
                            </h4>
                            <p style="color: azure; font-size: 14px; font-weight: 200;">
                                สำนักวิชาเทคโนโลยีสารสนเทศ
                                <br>
                                มหาวิทยาลัยแม่ฟ้าหลวง
                                <br>
                                333 หมู่ 1 ตำบลท่าสุด อำเภอเมือง จังหวัดเชียงราย 57100
                                <br>
                                โทรศัพท์ 0 5391 6741-2
                                <br>
                                โทรสาร 0 5391 6743
                                <br>
                                อีเมล: itschool@mfu.ac.th
                            </p>
                            <p></p>
                            <ul class="mfu-social">

                                <a href="https://www.facebook.com/itschool.mfu.page/" target="_blank"
                                    class="facebook-icon mr-3">
                                    <i class="fab fa-facebook">

                                    </i>
                                </a>

                                <a href="https://www.youtube.com/channel/UCbvvlT0UyZHCYdPTXL7vHXQ/featured"
                                    target="_blank" class="youtube-icon">
                                    <i class="fab fa-youtube">

                                    </i>
                                </a>
                            </ul>
                            <p></p>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-4 mt-5"><iframe
                            src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fitschool.mfu.page%2F&amp;tabs=timeline&amp;width=340&amp;height=250&amp;small_header=true&amp;adapt_container_width=true&amp;hide_cover=false&amp;show_facepile=true&amp;appId"
                            width="100%" height="300" style="border:none;overflow:hidden" scrolling="no" frameborder="0"
                            allowtransparency="true" allow="encrypted-media"></iframe>


                    </div>

                </div>
                <a class="scroll-to-top" style="display: none;">
                    <i class="fa fa-long-arrow-up" aria-hidden="true"></i>
                </a>
                <script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag() { dataLayer.push(arguments); }
                    gtag('js', new Date());

                    gtag('config', 'UA-148131712-1');
                </script>
                <script type="text/javascript" src="/assets/vendor/Export/jquery.table2excel.js"> </script>
                <script type="text/javascript" src="/assets/vendor/Export/jquery.table2excel.min.js"></script>


                <script type="text/javascript">
                    $('#excelExport').click(function () {
                        $('#myTable').table2excel({
                            exclude: ".noExl",
                            name: "ครุภัณฑ์",
                            filename: "ครุภัณฑ์"
                        })
                    });



                </script>



                <script type="text/javascript"
                    src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js"></script>
                <script type="text/javascript"
                    src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
                <script type="text/javascript">
                    $("body").on("click", "#btn_export_PDF", function () {
                        html2canvas($('#myTable')[0], {
                            onrendered: function (canvas) {
                                var data = canvas.toDataURL();
                                var docDefinition = {
                                    content: [{
                                        image: data,
                                        width: 500
                                    }]
                                };
                                pdfMake.createPdf(docDefinition).download("ครุภัณฑ์.pdf");
                            }
                        });
                    });
                </script>

            </div>
            <!-- ============================================================== -->
            <!-- ======================== เสร็จ footer ========================= -->
            <!-- ============================================================== -->
        </div>
    </div>
</body>